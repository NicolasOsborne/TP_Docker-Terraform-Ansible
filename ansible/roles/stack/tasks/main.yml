- name: Copy Docker stack file
  copy:
    src: ../docker/docker-stack.yml
    dest: /tmp/docker-stack.yml

- name: Copy Nginx configuration file for Docker Swarm
  copy:
    src: ../../docker/nginx/conf.d/default.conf
    dest: /tmp/docker/nginx/conf.d/default.conf
    force: yes

- name: Create Docker secrets - DB password
  shell: echo "glpi" | docker secret create db_password -
  ignore_errors: yes

- name: Create Docker secrets - Root DB password
  shell: echo "root" | docker secret create db_root_password -
  ignore_errors: yes

- name: Deploy stack
  command: docker stack deploy -c /tmp/docker-stack.yml tp_devops
